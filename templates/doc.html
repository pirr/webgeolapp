{% extends "doc_base.html" %}
{% block script %}
<script type="text/javascript">
    $(document).ready(function (){
        // $('#tabs').tab();
        console.log('MAP!');
        var map = L.map('map').setView([{{coord.lat}},{{coord.lon}}], 10);
        
        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            id: 'examples.map-i875mjb7'
        }).addTo(map);

        L.marker([{{coord.lat}},{{coord.lon}}]).addTo(map)
            .bindPopup('{{coord.lat}}, {{coord.lon}}').openPopup();

        var popup = L.popup();

        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent(e.latlng.toString())
                .openOn(map);
        }
        map.on('click', onMapClick);
        document.getElementById('map').style.display = 'block';
    });
</script>
{% endblock %}

{% block nav %}
<div class="container theme-showcase" role="main" style="margin-top: 0.5%;">
<p>
<!-- doc_editor button -->
<button class="btn btn-default" type="button" onclick="open_url('/doc_editor/{{doc.id}}')">Редактировать</button>
</p>
</div>
{% endblock %}
<div class="container">
{% block body %}
<!-- ! -->
<div id="content">
<h2>{{doc.name}}</h2>
    
    <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
        <li class="active"><a href="#doc_about" data-toggle="tab">О документе</a></li>
        <li><a href="#doc_map" data-toggle="tab">Карта</a></li>
    </ul>
    
    <!-- doc_about -->
    <div id="my-tab-content" class="tab-content">
        <div class="tab-pane active" id="doc_about">
            <table class="table table-bordered">
            <caption>Данные документа</caption>
            <tr><td>Название по документу:</td><td>{{doc.name}}</td></tr>
            <tr><td>Вид документа регистрации:</td><td>{{doc.source_type}}</td></tr>
            <tr><td>Орган регистрации:</td><td></td></tr>
            <tr><td>Субъект РФ:</td><td></td></tr>
            <tr><td>Административный район:</td><td></td></tr>
            <tr><td>Входимость в объект (группу):</td>
                <td>
                    <script type="text/javascript">
                        html_response('/object/{{doc.id}}', '#docs')
                    </script>
                    <div id="docs"></div>
                </td>
            </tr>
            </table>

            <table class="tab-pane active" class="table table-bordered">
            <caption>Запасы</caption>
            <tr>
                <td>Полезное ископаемое</td><td>Группа ПИ в госпрограмме</td>
                <td>АBC1</td><td>C2</td><td>Документ утверждения запасов</td>
                <td>Номер</td><td>Дата</td><td>Организация</td>
            </tr>
            {% for pi in pis %}
            <tr>
                <td>{{pi.pi}}</td><td>{{pi.group_pi}}</td><td></td><td></td>
                <td></td><td></td><td></td><td></td>
            </tr>
            {% endfor %}
            </table>

            <table class="table table-bordered">
            <caption>Прогнозные ресурсы</caption>
            <tr>
                <td>Полезное ископаемое</td><td>Группа ПИ в госпрограмме</td>
                <td>P1</td><td>P2</td><td>P3</td>
                <td>Без категории</td><td>Документ апробации</td><td>Номер</td><td>Дата</td><td>Организация</td>
            </tr>
            {% for pi in pis %}
            <tr>
                <td>{{pi.pi}}</td><td>{{pi.group_pi}}</td><td></td><td></td>
                <td></td><td></td><td></td><td></td><td></td><td></td>
            </tr>
            {% endfor %}
            </table>
        </div>
        <!-- ! -->

        <!-- map -->
        <div  class="tab-pane active" id="doc_map" >
            <div id="map" style="width: 1140px; height: 800px"></div>
            <!-- <script type="text/javascript">
                console.log('MAP!')
                var map = L.map('map').setView([{{coord.lat}},{{coord.lon}}], 10);
                
                L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                    id: 'examples.map-i875mjb7'
                }).addTo(map);
            
                L.marker([{{coord.lat}},{{coord.lon}}]).addTo(map)
                    .bindPopup('{{coord.lat}}, {{coord.lon}}').openPopup();

                var popup = L.popup();

                function onMapClick(e) {
                    popup
                        .setLatLng(e.latlng)
                        .setContent(e.latlng.toString())
                        .openOn(map);
                }
                map.on('click', onMapClick);
            </script> -->
        </div>
        <!-- ! -->
</div>
 

</div> <!-- container -->
<script type="text/javascript">
{% endblock %}