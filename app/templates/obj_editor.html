{% extends "obj_base.html" %}
{% block script %}
<script type="text/javascript">
var docs_res = new Array();

$(document).ready( function() {
    var doc_id_push = $('#doc_id_push').val();
    var doc_id_pull = $('#doc_id_pull').val();
    $.ajax({
        type: "POST",
        url: '/obj_docs/{{obj.obj_id}}',
        data: JSON.stringify({doc_id_push:doc_id_push,
                                doc_id_pull:doc_id_pull}),
        success: function(response) {
            search('/obj_search/{{obj.obj_id}}');
            $('#obj_docs').html(response.html);
        }
    });
});

function canselEdit() {
    location.reload();
}

function postDataObj() {
    var obj_name = $('#obj_name:input').val();
    $.ajax({
        type: 'POST',
        url: '/obj_edit_post/{{obj.obj_id}}',
        data: JSON.stringify({obj_name:obj_name}),
        success: function(response) {
            if (response=='Err') 'Err';
            else location.reload();
        }
    })
}

function obj_search_name() {
    docs_res = 0
    console.log(docs_res)
    search('/obj_search/{{obj.obj_id}}')
}

</script>
{% endblock %}

{% block leftnav %}
<li><a>Объект №<b>{{obj.obj_id}}</b> Название: <b>{{obj.name}}</b></a></li>
{% endblock %}
{% block nav %}
<button class="btn btn-default navbar-btn" type="button" onclick="postDataObj()">Сохранить изменения</button>
<button class="btn btn-default navbar-btn" type="button" onclick="canselEdit()">Отменить изменения</button>
{% endblock %}

{% block body %}
<!-- obj_about -->
<table class="table table-bordered">
    <caption>Данные объекта</caption>
        <col width="250">
        <tr>
            <td>Название присвоенное объекту:</td><td><input type="text" class="form-control" value="{{obj.name}}" id="obj_name"></td>
        </tr>
        <tr>
            <td>Полезные ископаемые объекта:</td><td>{{obj.pi}}</td>
        </tr>
</table>

<div id="obj_docs"></div>

<h3>Поиск документов для группировки</h3>
<div id='filters'>
    <table class="table table-bordered">
        <tr>
            <td><input id="searchname" type="text" 
                    onkeyup="obj_search_name()" placeholder="Найти по названию" value="{{obj.name}}" />
            </td>
        </tr>
    </table>
</div>

<div id="search_results"></div>

{% endblock %}